//// ------------------------------------------------------
//// THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
//// ------------------------------------------------------

Table Bookmark {
  id Int [pk, increment]
  userId Int [not null]
  forestId Int [not null]
  createdAt DateTime [default: `now()`, not null]
  user User [not null]
  forest Forest [not null]
}

Table User {
  id Int [pk, increment]
  email String [unique, not null]
  supabaseUserId String [unique]
  firstName String [not null]
  lastName String [not null]
  company String
  role UserRole [not null, default: 'USER']
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [not null]
  deletedAt DateTime
  orders Order [not null]
  bookmarks Bookmark [not null]
  cartItems CartItem [not null]
  emailVerified Boolean [not null, default: false]
}

Table Forest {
  id Int [pk, increment]
  name String [not null]
  location String [not null]
  type String [not null]
  area Float [not null]
  description String [not null]
  status ForestStatus [not null, default: 'ACTIVE']
  lastUpdated DateTime [not null]
  createdAt DateTime [default: `now()`, not null]
  deletedAt DateTime
  credits CarbonCredit [not null]
  bookmarks Bookmark [not null]
}

Table CarbonCredit {
  id Int [pk, increment]
  forestId Int [not null]
  vintage Int [not null]
  certification String [not null]
  totalCredits Int [not null]
  availableCredits Int [not null]
  pricePerCredit Float [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [not null]
  deletedAt DateTime
  forest Forest [not null]
  orderItems OrderItem [not null]
  cartItems CartItem [not null]
  symbol String [not null, default: 'tCOâ‚‚']
  retiredCredits Int [not null, default: 0]
  exchangeRates ExchangeRate [not null]
}

Table ExchangeRate {
  id Int [pk, increment]
  carbonCredit CarbonCredit [not null]
  carbonCreditId Int [not null]
  rate Float [not null]
  currency String [not null, default: 'USD']
  effectiveFrom DateTime [not null]
  effectiveTo DateTime
  orderItems OrderItem [not null]
}

Table Order {
  id Int [pk, increment]
  orderCode Int [unique, not null]
  userId Int [not null]
  createdAt DateTime [default: `now()`, not null]
  status OrderStatus [not null, default: 'PENDING']
  totalPrice Float [not null]
  totalCredits Int [not null, default: 0]
  currency String [not null, default: 'USD']
  totalUsd Float [not null, default: 0]
  deletedAt DateTime
  user User [not null]
  items OrderItem [not null]
  seller String [not null]
  buyer String [not null]
  paidAt DateTime
  shippingAddress String
  failureReason String
  paymentProvider String [not null, default: 'PAYOS']
  payments Payment [not null]
  orderHistory OrderHistory [not null]
  certificate Certificate
}

Table OrderItem {
  id Int [pk, increment]
  orderId Int [not null]
  carbonCreditId Int [not null]
  quantity Int [not null]
  pricePerCredit Float [not null]
  subtotal Float [not null]
  usdAmount Float [not null, default: 0]
  exchangeRate ExchangeRate
  exchangeRateId Int
  order Order [not null]
  carbonCredit CarbonCredit [not null]
  retired Boolean [not null, default: false]
}

Table CartItem {
  id Int [pk, increment]
  user User [not null]
  userId Int [not null]
  carbonCredit CarbonCredit [not null]
  carbonCreditId Int [not null]
  quantity Int [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [not null]
  addedAt DateTime [default: `now()`, not null]

  indexes {
    (userId, carbonCreditId) [unique]
  }
}

Table Payment {
  id Int [pk, increment]
  orderId Int [not null]
  order Order [not null]
  orderCode Int [not null]
  amount Float [not null]
  currency String [not null, default: 'USD']
  status PaymentStatus [not null, default: 'PENDING']
  failureReason String
  method String
  paidAt DateTime
  paymentData Json
  payosPaymentLinkId String
  payosOrderCode Int
  payosReference String
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [not null]
}

Table OrderHistory {
  id Int [pk, increment]
  order Order [not null]
  orderId Int [not null]
  event String [not null]
  message String
  createdAt DateTime [default: `now()`, not null]
}

Table Certificate {
  id String [pk]
  orderId Int [unique, not null]
  order Order [not null]
  certificateHash String [unique, not null]
  issuedAt DateTime [default: `now()`, not null]
  status CertificateStatus [not null, default: 'active']
  metadata Json
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [not null]
}

Table WebhookEvent {
  id String [pk]
  orderCode Int [not null]
  signature String [unique, not null]
  status String [not null, default: 'RETRYING']
  processedAt DateTime
  retryCount Int [not null, default: 0]
  errorMessage String
  webhookData Json [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [not null]
}

Enum OrderStatus {
  PENDING
  PAID
  PROCESSING
  COMPLETED
  CANCELLED
  FAILED
  EXPIRED
}

Enum PaymentStatus {
  PENDING
  PAID
  FAILED
  CANCELLED
  EXPIRED
}

Enum UserRole {
  USER
  ADMIN
}

Enum ForestStatus {
  ACTIVE
  MONITORING
  INACTIVE
}

Enum CertificateStatus {
  active
  revoked
  expired
}

Ref: Bookmark.userId > User.id [delete: Cascade]

Ref: Bookmark.forestId > Forest.id [delete: Cascade]

Ref: CarbonCredit.forestId > Forest.id [delete: Cascade]

Ref: ExchangeRate.carbonCreditId > CarbonCredit.id [delete: Cascade]

Ref: Order.userId > User.id [delete: Restrict]

Ref: OrderItem.exchangeRateId > ExchangeRate.id

Ref: OrderItem.orderId > Order.id [delete: Cascade]

Ref: OrderItem.carbonCreditId > CarbonCredit.id [delete: Restrict]

Ref: CartItem.userId > User.id [delete: Cascade]

Ref: CartItem.carbonCreditId > CarbonCredit.id [delete: Cascade]

Ref: Payment.orderId > Order.id [delete: Cascade]

Ref: OrderHistory.orderId > Order.id [delete: Cascade]

Ref: Certificate.orderId - Order.id [delete: Cascade]